diff --git a/chartbeat.module b/chartbeat.module
index 2cbf882..df275ee 100644
--- a/chartbeat.module
+++ b/chartbeat.module
@@ -53,10 +53,10 @@ function chartbeat_page_alter(&$page) {
   $uid = variable_get('chartbeat_uid', '');
   if (!empty($uid)) {
     $output = <<<EOT
-<script type="text/javascript">
-  var _sf_async_config=Drupal.settings.chartbeat;
+  var _sf_async_config;
   (function(){
     function loadChartbeat() {
+      var _sf_async_config=Drupal.settings.chartbeat;
       window._sf_endpt=(new Date()).getTime();
       var e = document.createElement('script');
       e.setAttribute('language', 'javascript');
@@ -70,8 +70,7 @@ function chartbeat_page_alter(&$page) {
     window.onload = (typeof window.onload != 'function') ?
        loadChartbeat : function() { oldonload(); loadChartbeat(); };
   })();
-</script>
 EOT;
-    $page['page_bottom']['chartbeat'] = array('#markup' => $output);
+    drupal_add_js($output, array('type' => 'inline', 'scope' => 'footer'));
   }
 }
